<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>积分运营管理 - 电商后台</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
  background-color: #f8fafc;
  color: #1e293b;
  line-height: 1.6;
}

.container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 24px;
}

/* Header */
.header {
  background: white;
  border-bottom: 1px solid #e2e8f0;
  padding: 24px 0;
}

.header-content {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.header-left h1 {
  font-size: 28px;
  font-weight: 700;
  color: #1e293b;
  margin-bottom: 4px;
}

.header-left p {
  color: #64748b;
  font-size: 14px;
}

.header-right {
  display: flex;
  gap: 12px;
}

/* Buttons */
.btn {
  padding: 8px 16px;
  border-radius: 6px;
  border: none;
  font-size: 14px;
  font-weight: 500;
  cursor: pointer;
  display: inline-flex;
  align-items: center;
  gap: 8px;
  transition: all 0.2s;
}

.btn-primary {
  background: #3b82f6;
  color: white;
}

.btn-primary:hover {
  background: #2563eb;
}

.btn-outline {
  background: white;
  color: #64748b;
  border: 1px solid #e2e8f0;
}

.btn-outline:hover {
  background: #f8fafc;
}

.btn-ghost {
  background: transparent;
  color: #64748b;
  padding: 4px 8px;
}

.btn-ghost:hover {
  background: #f1f5f9;
}

/* Main Content */
.main {
  padding: 24px 0;
}

/* Stats Grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 24px;
  margin-bottom: 32px;
}

.stat-card {
  background: white;
  border-radius: 8px;
  padding: 24px;
  border: 1px solid #e2e8f0;
}

.stat-content {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.stat-info h3 {
  font-size: 14px;
  color: #64748b;
  font-weight: 500;
  margin-bottom: 8px;
}

.stat-value {
  font-size: 24px;
  font-weight: 700;
  color: #1e293b;
  margin-bottom: 4px;
}

.stat-change {
  font-size: 12px;
}

.stat-change.positive {
  color: #059669;
}

.stat-change.negative {
  color: #dc2626;
}

.stat-icon {
  width: 48px;
  height: 48px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 20px;
}

.stat-icon.blue {
  background: #dbeafe;
  color: #2563eb;
}

.stat-icon.green {
  background: #d1fae5;
  color: #059669;
}

.stat-icon.orange {
  background: #fed7aa;
  color: #ea580c;
}

.stat-icon.purple {
  background: #e9d5ff;
  color: #9333ea;
}

/* Tabs */
.tabs-container {
  background: white;
  border-radius: 8px;
  border: 1px solid #e2e8f0;
  overflow: hidden;
}

.tabs-nav {
  display: flex;
  border-bottom: 1px solid #e2e8f0;
}

.tab-btn {
  flex: 1;
  padding: 16px 24px;
  background: none;
  border: none;
  font-size: 14px;
  font-weight: 500;
  color: #64748b;
  cursor: pointer;
  transition: all 0.2s;
  border-bottom: 2px solid transparent;
}

.tab-btn:hover {
  background: #f8fafc;
}

.tab-btn.active {
  color: #3b82f6;
  border-bottom-color: #3b82f6;
  background: #f8fafc;
}

.tab-content {
  display: none;
  padding: 24px;
}

.tab-content.active {
  display: block;
}

/* Cards */
.card {
  background: white;
  border-radius: 8px;
  border: 1px solid #e2e8f0;
}

.card-header {
  padding: 24px;
  border-bottom: 1px solid #e2e8f0;
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
}

.card-title h2 {
  font-size: 20px;
  font-weight: 600;
  margin-bottom: 4px;
}

.card-title p {
  color: #64748b;
  font-size: 14px;
}

.card-content {
  padding: 24px;
}

/* Rules List */
.rules-list {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.rule-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 16px;
  border: 1px solid #e2e8f0;
  border-radius: 8px;
}

.rule-info h3 {
  font-size: 16px;
  font-weight: 500;
  margin-bottom: 4px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.rule-info p {
  color: #64748b;
  font-size: 14px;
  margin-bottom: 8px;
}

.rule-points {
  color: #3b82f6;
  font-weight: 500;
  font-size: 14px;
}

.rule-actions {
  display: flex;
  gap: 8px;
}

/* Badge */
.badge {
  padding: 4px 8px;
  border-radius: 4px;
  font-size: 12px;
  font-weight: 500;
}

.badge.active {
  background: #dcfce7;
  color: #166534;
}

.badge.inactive {
  background: #f1f5f9;
  color: #475569;
}

.badge.earn {
  background: #dcfce7;
  color: #166534;
}

.badge.spend {
  background: #fee2e2;
  color: #991b1b;
}

/* Search and Filters */
.search-filters {
  display: flex;
  gap: 12px;
  align-items: center;
}

.search-box {
  position: relative;
}

.search-box i {
  position: absolute;
  left: 12px;
  top: 50%;
  transform: translateY(-50%);
  color: #9ca3af;
}

.search-box input {
  padding: 8px 12px 8px 36px;
  border: 1px solid #e2e8f0;
  border-radius: 6px;
  font-size: 14px;
  width: 250px;
}

.search-box input:focus {
  outline: none;
  border-color: #3b82f6;
}

select {
  padding: 8px 12px;
  border: 1px solid #e2e8f0;
  border-radius: 6px;
  font-size: 14px;
  background: white;
}

/* Table */
.table-container {
  overflow-x: auto;
}

.data-table {
  width: 100%;
  border-collapse: collapse;
}

.data-table th,
.data-table td {
  padding: 12px;
  text-align: left;
  border-bottom: 1px solid #e2e8f0;
}

.data-table th {
  font-weight: 500;
  color: #64748b;
  font-size: 14px;
}

.data-table td {
  font-size: 14px;
}

.points-positive {
  color: #059669;
}

.points-negative {
  color: #dc2626;
}

/* Activities List */
.activities-list {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.activity-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 16px;
  border: 1px solid #e2e8f0;
  border-radius: 8px;
}

.activity-info h3 {
  font-size: 16px;
  font-weight: 500;
  margin-bottom: 8px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.activity-details {
  display: flex;
  gap: 16px;
  color: #64748b;
  font-size: 14px;
}

.activity-actions {
  display: flex;
  gap: 8px;
}

/* Analytics */
.analytics-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 24px;
}

.chart-placeholder {
  height: 200px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  color: #9ca3af;
  text-align: center;
}

.chart-placeholder i {
  font-size: 48px;
  margin-bottom: 16px;
}

.distribution-chart {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.distribution-item {
  display: flex;
  align-items: center;
  gap: 12px;
  font-size: 14px;
}

.distribution-item span:first-child {
  width: 100px;
  flex-shrink: 0;
}

.distribution-item span:last-child {
  width: 40px;
  text-align: right;
  color: #64748b;
}

.progress-bar {
  flex: 1;
  height: 8px;
  background: #e2e8f0;
  border-radius: 4px;
  overflow: hidden;
}

.progress-fill {
  height: 100%;
  background: #3b82f6;
  transition: width 0.3s ease;
}

/* Modal */
.modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.5);
  z-index: 1000;
}

.modal.show {
  display: flex;
  align-items: center;
  justify-content: center;
}

.modal-content {
  background: white;
  border-radius: 8px;
  width: 90%;
  max-width: 500px;
  max-height: 90vh;
  overflow-y: auto;
}

.modal-header {
  padding: 24px 24px 0;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.modal-header h3 {
  font-size: 18px;
  font-weight: 600;
}

.modal-close {
  background: none;
  border: none;
  font-size: 24px;
  cursor: pointer;
  color: #64748b;
}

.modal-body {
  padding: 24px;
}

.modal-footer {
  padding: 0 24px 24px;
  display: flex;
  justify-content: flex-end;
  gap: 12px;
}

/* Form */
.form-group {
  margin-bottom: 16px;
}

.form-group label {
  display: block;
  margin-bottom: 8px;
  font-weight: 500;
  font-size: 14px;
}

.form-group input,
.form-group textarea,
.form-group select {
  width: 100%;
  padding: 8px 12px;
  border: 1px solid #e2e8f0;
  border-radius: 6px;
  font-size: 14px;
}

.form-group input:focus,
.form-group textarea:focus,
.form-group select:focus {
  outline: none;
  border-color: #3b82f6;
}

.form-group textarea {
  resize: vertical;
  min-height: 80px;
}

/* Switch */
.switch-label {
  display: flex !important;
  align-items: center;
  gap: 12px;
  cursor: pointer;
}

.switch-label input[type="checkbox"] {
  display: none;
}

.switch-slider {
  width: 44px;
  height: 24px;
  background: #e2e8f0;
  border-radius: 12px;
  position: relative;
  transition: background 0.2s;
}

.switch-slider::before {
  content: "";
  position: absolute;
  width: 20px;
  height: 20px;
  background: white;
  border-radius: 50%;
  top: 2px;
  left: 2px;
  transition: transform 0.2s;
}

.switch-label input[type="checkbox"]:checked + .switch-slider {
  background: #3b82f6;
}

.switch-label input[type="checkbox"]:checked + .switch-slider::before {
  transform: translateX(20px);
}

/* Responsive */
@media (max-width: 768px) {
  .header-content {
    flex-direction: column;
    gap: 16px;
    align-items: flex-start;
  }

  .header-right {
    width: 100%;
    justify-content: flex-end;
  }

  .stats-grid {
    grid-template-columns: 1fr;
  }

  .tabs-nav {
    flex-wrap: wrap;
  }

  .tab-btn {
    flex: none;
    min-width: 25%;
  }

  .search-filters {
    flex-direction: column;
    align-items: stretch;
  }

  .search-box input {
    width: 100%;
  }

  .analytics-grid {
    grid-template-columns: 1fr;
  }

  .rule-item,
  .activity-item {
    flex-direction: column;
    align-items: flex-start;
    gap: 12px;
  }

  .rule-actions,
  .activity-actions {
    align-self: flex-end;
  }
}

    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="header-left">
                    <h1>积分运营管理</h1>
                    <p>管理用户积分规则、记录和活动</p>
                </div>
                <div class="header-right">
                    <button class="btn btn-outline">
                        <i class="fas fa-download"></i>
                        导出数据
                    </button>
                    <button class="btn btn-primary" onclick="openActivityModal()">
                        <i class="fas fa-plus"></i>
                        新建活动
                    </button>
                </div>
            </div>
        </div>
    </header>

    <main class="main">
        <div class="container">
            <!-- Stats Cards -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-content">
                        <div class="stat-info">
                            <h3>总积分池</h3>
                            <div class="stat-value">2,847,392</div>
                            <div class="stat-change positive">+12.5% 较昨日</div>
                        </div>
                        <div class="stat-icon blue">
                            <i class="fas fa-coins"></i>
                        </div>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-content">
                        <div class="stat-info">
                            <h3>今日发放</h3>
                            <div class="stat-value">15,847</div>
                            <div class="stat-change positive">+8.2% 较昨日</div>
                        </div>
                        <div class="stat-icon green">
                            <i class="fas fa-gift"></i>
                        </div>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-content">
                        <div class="stat-info">
                            <h3>今日消费</h3>
                            <div class="stat-value">12,394</div>
                            <div class="stat-change negative">-3.1% 较昨日</div>
                        </div>
                        <div class="stat-icon orange">
                            <i class="fas fa-chart-line"></i>
                        </div>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-content">
                        <div class="stat-info">
                            <h3>活跃用户</h3>
                            <div class="stat-value">8,429</div>
                            <div class="stat-change positive">+15.3% 较昨日</div>
                        </div>
                        <div class="stat-icon purple">
                            <i class="fas fa-users"></i>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tabs -->
            <div class="tabs-container">
                <div class="tabs-nav">
                    <button class="tab-btn active" onclick="switchTab('rules')">积分规则</button>
                    <button class="tab-btn" onclick="switchTab('records')">积分记录</button>
                    <button class="tab-btn" onclick="switchTab('activities')">积分活动</button>
                    <button class="tab-btn" onclick="switchTab('analytics')">数据分析</button>
                </div>

                <!-- 积分规则 Tab -->
                <div id="rules-tab" class="tab-content active">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">
                                <h2>积分规则管理</h2>
                                <p>配置和管理各种积分获取规则</p>
                            </div>
                            <button class="btn btn-primary" onclick="openRuleModal()">
                                <i class="fas fa-plus"></i>
                                添加规则
                            </button>
                        </div>
                        <div class="card-content">
                            <div id="rules-list" class="rules-list">
                                <!-- 规则列表将通过JavaScript动态生成 -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 积分记录 Tab -->
                <div id="records-tab" class="tab-content">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">
                                <h2>积分记录</h2>
                                <p>查看所有用户的积分获取和消费记录</p>
                            </div>
                            <div class="search-filters">
                                <div class="search-box">
                                    <i class="fas fa-search"></i>
                                    <input type="text" id="search-input" placeholder="搜索用户..." onkeyup="filterRecords()">
                                </div>
                                <select id="type-filter" onchange="filterRecords()">
                                    <option value="all">全部</option>
                                    <option value="earn">获得</option>
                                    <option value="spend">消费</option>
                                </select>
                            </div>
                        </div>
                        <div class="card-content">
                            <div class="table-container">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>用户ID</th>
                                            <th>用户名</th>
                                            <th>类型</th>
                                            <th>积分变动</th>
                                            <th>原因</th>
                                            <th>余额</th>
                                            <th>时间</th>
                                        </tr>
                                    </thead>
                                    <tbody id="records-tbody">
                                        <!-- 记录将通过JavaScript动态生成 -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 积分活动 Tab -->
                <div id="activities-tab" class="tab-content">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">
                                <h2>积分活动</h2>
                                <p>管理积分相关的营销活动</p>
                            </div>
                            <button class="btn btn-primary" onclick="openActivityModal()">
                                <i class="fas fa-plus"></i>
                                创建活动
                            </button>
                        </div>
                        <div class="card-content">
                            <div id="activities-list" class="activities-list">
                                <!-- 活动列表将通过JavaScript动态生成 -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 数据分析 Tab -->
                <div id="analytics-tab" class="tab-content">
                    <div class="analytics-grid">
                        <div class="card">
                            <div class="card-header">
                                <div class="card-title">
                                    <h2>积分趋势分析</h2>
                                    <p>最近30天积分发放和消费趋势</p>
                                </div>
                            </div>
                            <div class="card-content">
                                <div class="chart-placeholder">
                                    <i class="fas fa-chart-line"></i>
                                    <p>积分趋势图表</p>
                                    <small>（此处可集成图表组件）</small>
                                </div>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-header">
                                <div class="card-title">
                                    <h2>用户积分分布</h2>
                                    <p>不同积分区间的用户分布情况</p>
                                </div>
                            </div>
                            <div class="card-content">
                                <div class="distribution-chart">
                                    <div class="distribution-item">
                                        <span>0-100积分</span>
                                        <div class="progress-bar">
                                            <div class="progress-fill" style="width: 25%"></div>
                                        </div>
                                        <span>25%</span>
                                    </div>
                                    <div class="distribution-item">
                                        <span>101-500积分</span>
                                        <div class="progress-bar">
                                            <div class="progress-fill" style="width: 40%"></div>
                                        </div>
                                        <span>40%</span>
                                    </div>
                                    <div class="distribution-item">
                                        <span>501-1000积分</span>
                                        <div class="progress-bar">
                                            <div class="progress-fill" style="width: 20%"></div>
                                        </div>
                                        <span>20%</span>
                                    </div>
                                    <div class="distribution-item">
                                        <span>1000+积分</span>
                                        <div class="progress-bar">
                                            <div class="progress-fill" style="width: 15%"></div>
                                        </div>
                                        <span>15%</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- 添加规则弹窗 -->
    <div id="rule-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>添加积分规则</h3>
                <button class="modal-close" onclick="closeRuleModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="rule-name">规则名称</label>
                    <input type="text" id="rule-name" placeholder="输入规则名称">
                </div>
                <div class="form-group">
                    <label for="rule-points">积分数量</label>
                    <input type="number" id="rule-points" placeholder="输入积分数量">
                </div>
                <div class="form-group">
                    <label for="rule-desc">规则描述</label>
                    <textarea id="rule-desc" placeholder="输入规则描述"></textarea>
                </div>
                <div class="form-group">
                    <label class="switch-label">
                        <input type="checkbox" id="rule-status" checked>
                        <span class="switch-slider"></span>
                        启用规则
                    </label>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeRuleModal()">取消</button>
                <button class="btn btn-primary" onclick="saveRule()">保存规则</button>
            </div>
        </div>
    </div>

    <!-- 创建活动弹窗 -->
    <div id="activity-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>创建积分活动</h3>
                <button class="modal-close" onclick="closeActivityModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="activity-name">活动名称</label>
                    <input type="text" id="activity-name" placeholder="输入活动名称">
                </div>
                <div class="form-group">
                    <label for="activity-type">活动类型</label>
                    <select id="activity-type">
                        <option value="multiplier">积分翻倍</option>
                        <option value="lottery">积分抽奖</option>
                        <option value="discount">消费满减</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="activity-start">开始时间</label>
                    <input type="date" id="activity-start">
                </div>
                <div class="form-group">
                    <label for="activity-end">结束时间</label>
                    <input type="date" id="activity-end">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeActivityModal()">取消</button>
                <button class="btn btn-primary" onclick="saveActivity()">创建活动</button>
            </div>
        </div>
    </div>

    <script>
        // 模拟数据
const pointsRules = [
  { id: 1, name: "注册奖励", points: 100, status: "active", description: "新用户注册即可获得积分" },
  { id: 2, name: "每日签到", points: 10, status: "active", description: "每日签到获得积分" },
  { id: 3, name: "购物返积分", points: 0, status: "active", description: "消费1元返1积分" },
  { id: 4, name: "邀请好友", points: 200, status: "active", description: "成功邀请好友注册" },
  { id: 5, name: "评价商品", points: 20, status: "inactive", description: "完成商品评价" },
]

const pointsRecords = [
  {
    id: 1,
    userId: "U001",
    username: "张三",
    type: "earn",
    points: 100,
    reason: "注册奖励",
    time: "2024-01-15 10:30:00",
    balance: 1250,
  },
  {
    id: 2,
    userId: "U002",
    username: "李四",
    type: "spend",
    points: -50,
    reason: "兑换优惠券",
    time: "2024-01-15 09:45:00",
    balance: 890,
  },
  {
    id: 3,
    userId: "U003",
    username: "王五",
    type: "earn",
    points: 25,
    reason: "购物返积分",
    time: "2024-01-15 08:20:00",
    balance: 675,
  },
  {
    id: 4,
    userId: "U001",
    username: "张三",
    type: "earn",
    points: 10,
    reason: "每日签到",
    time: "2024-01-14 16:15:00",
    balance: 1150,
  },
  {
    id: 5,
    userId: "U004",
    username: "赵六",
    type: "spend",
    points: -100,
    reason: "积分抽奖",
    time: "2024-01-14 14:30:00",
    balance: 450,
  },
]

const activities = [
  {
    id: 1,
    name: "新春积分翻倍",
    type: "multiplier",
    status: "active",
    startTime: "2024-01-01",
    endTime: "2024-01-31",
    participants: 1250,
  },
  {
    id: 2,
    name: "积分大转盘",
    type: "lottery",
    status: "active",
    startTime: "2024-01-10",
    endTime: "2024-01-20",
    participants: 890,
  },
  {
    id: 3,
    name: "消费满减",
    type: "discount",
    status: "ended",
    startTime: "2023-12-01",
    endTime: "2023-12-31",
    participants: 2340,
  },
]

// 页面加载完成后初始化
document.addEventListener("DOMContentLoaded", () => {
  renderRules()
  renderRecords()
  renderActivities()
})

// 切换标签页
function switchTab(tabName) {
  // 移除所有活动状态
  document.querySelectorAll(".tab-btn").forEach((btn) => btn.classList.remove("active"))
  document.querySelectorAll(".tab-content").forEach((content) => content.classList.remove("active"))

  // 添加活动状态
  event.target.classList.add("active")
  document.getElementById(tabName + "-tab").classList.add("active")
}

// 渲染积分规则
function renderRules() {
  const rulesList = document.getElementById("rules-list")
  rulesList.innerHTML = ""

  pointsRules.forEach((rule) => {
    const ruleItem = document.createElement("div")
    ruleItem.className = "rule-item"
    ruleItem.innerHTML = `
            <div class="rule-info">
                <h3>
                    ${rule.name}
                    <span class="badge ${rule.status}">${rule.status === "active" ? "启用" : "禁用"}</span>
                </h3>
                <p>${rule.description}</p>
                <div class="rule-points">+${rule.points} 积分</div>
            </div>
            <div class="rule-actions">
                <button class="btn btn-ghost" onclick="editRule(${rule.id})">
                    <i class="fas fa-edit"></i>
                </button>
                <button class="btn btn-ghost" onclick="deleteRule(${rule.id})">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
        `
    rulesList.appendChild(ruleItem)
  })
}

// 渲染积分记录
function renderRecords(filteredRecords = pointsRecords) {
  const tbody = document.getElementById("records-tbody")
  tbody.innerHTML = ""

  filteredRecords.forEach((record) => {
    const row = document.createElement("tr")
    row.innerHTML = `
            <td><code>${record.userId}</code></td>
            <td>${record.username}</td>
            <td><span class="badge ${record.type}">${record.type === "earn" ? "获得" : "消费"}</span></td>
            <td class="${record.points > 0 ? "points-positive" : "points-negative"}">
                ${record.points > 0 ? "+" : ""}${record.points}
            </td>
            <td>${record.reason}</td>
            <td><strong>${record.balance}</strong></td>
            <td>${record.time}</td>
        `
    tbody.appendChild(row)
  })
}

// 渲染积分活动
function renderActivities() {
  const activitiesList = document.getElementById("activities-list")
  activitiesList.innerHTML = ""

  activities.forEach((activity) => {
    const activityItem = document.createElement("div")
    activityItem.className = "activity-item"

    const statusText = activity.status === "active" ? "进行中" : activity.status === "ended" ? "已结束" : "未开始"
    const typeText = activity.type === "multiplier" ? "积分翻倍" : activity.type === "lottery" ? "积分抽奖" : "消费满减"

    activityItem.innerHTML = `
            <div class="activity-info">
                <h3>
                    ${activity.name}
                    <span class="badge ${activity.status}">${statusText}</span>
                </h3>
                <div class="activity-details">
                    <span>类型: ${typeText}</span>
                    <span>参与人数: ${activity.participants}</span>
                    <span>时间: ${activity.startTime} ~ ${activity.endTime}</span>
                </div>
            </div>
            <div class="activity-actions">
                <button class="btn btn-ghost">查看详情</button>
                <button class="btn btn-ghost" onclick="editActivity(${activity.id})">
                    <i class="fas fa-edit"></i>
                </button>
            </div>
        `
    activitiesList.appendChild(activityItem)
  })
}

// 筛选积分记录
function filterRecords() {
  const searchTerm = document.getElementById("search-input").value.toLowerCase()
  const typeFilter = document.getElementById("type-filter").value

  let filteredRecords = pointsRecords

  // 按搜索词筛选
  if (searchTerm) {
    filteredRecords = filteredRecords.filter(
      (record) =>
        record.username.toLowerCase().includes(searchTerm) || record.userId.toLowerCase().includes(searchTerm),
    )
  }

  // 按类型筛选
  if (typeFilter !== "all") {
    filteredRecords = filteredRecords.filter((record) => record.type === typeFilter)
  }

  renderRecords(filteredRecords)
}

// 打开规则弹窗
function openRuleModal() {
  document.getElementById("rule-modal").classList.add("show")
}

// 关闭规则弹窗
function closeRuleModal() {
  document.getElementById("rule-modal").classList.remove("show")
  // 清空表单
  document.getElementById("rule-name").value = ""
  document.getElementById("rule-points").value = ""
  document.getElementById("rule-desc").value = ""
  document.getElementById("rule-status").checked = true
}

// 保存规则
function saveRule() {
  const name = document.getElementById("rule-name").value
  const points = Number.parseInt(document.getElementById("rule-points").value)
  const description = document.getElementById("rule-desc").value
  const status = document.getElementById("rule-status").checked ? "active" : "inactive"

  if (!name || !points || !description) {
    alert("请填写完整信息")
    return
  }

  const newRule = {
    id: pointsRules.length + 1,
    name,
    points,
    description,
    status,
  }

  pointsRules.push(newRule)
  renderRules()
  closeRuleModal()
  alert("规则添加成功！")
}

// 编辑规则
function editRule(id) {
  const rule = pointsRules.find((r) => r.id === id)
  if (rule) {
    alert(`编辑规则: ${rule.name}`)
    // 这里可以实现编辑功能
  }
}

// 删除规则
function deleteRule(id) {
  if (confirm("确定要删除这个规则吗？")) {
    const index = pointsRules.findIndex((r) => r.id === id)
    if (index > -1) {
      pointsRules.splice(index, 1)
      renderRules()
      alert("规则删除成功！")
    }
  }
}

// 打开活动弹窗
function openActivityModal() {
  document.getElementById("activity-modal").classList.add("show")
}

// 关闭活动弹窗
function closeActivityModal() {
  document.getElementById("activity-modal").classList.remove("show")
  // 清空表单
  document.getElementById("activity-name").value = ""
  document.getElementById("activity-type").value = "multiplier"
  document.getElementById("activity-start").value = ""
  document.getElementById("activity-end").value = ""
}

// 保存活动
function saveActivity() {
  const name = document.getElementById("activity-name").value
  const type = document.getElementById("activity-type").value
  const startTime = document.getElementById("activity-start").value
  const endTime = document.getElementById("activity-end").value

  if (!name || !startTime || !endTime) {
    alert("请填写完整信息")
    return
  }

  const newActivity = {
    id: activities.length + 1,
    name,
    type,
    status: "active",
    startTime,
    endTime,
    participants: 0,
  }

  activities.push(newActivity)
  renderActivities()
  closeActivityModal()
  alert("活动创建成功！")
}

// 编辑活动
function editActivity(id) {
  const activity = activities.find((a) => a.id === id)
  if (activity) {
    alert(`编辑活动: ${activity.name}`)
    // 这里可以实现编辑功能
  }
}

// 点击弹窗外部关闭弹窗
document.addEventListener("click", (e) => {
  if (e.target.classList.contains("modal")) {
    e.target.classList.remove("show")
  }
})

    </script>
</body>
</html>
